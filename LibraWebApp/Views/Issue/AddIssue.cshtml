@{
    Layout = "~/Views/Shared/_LayoutLTE.cshtml";
}

<h3 class="accent-gray-dark mt-5">New Issue</h3>

@model LibraBll.DTOs.Pos.PosGetDTO

@using (Html.BeginForm("AddIssue", "Issue", FormMethod.Post, new { id = "AddIssueForm" }))
{
    <div class="card mb-0">
        <div class="card-header" style="background-color: lightgray">
            Search the POS
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-2">
                    <label for="inputPosName" class="form-label">Id</label>
                    <div class="input-group">
                        <div class="input-group-text"><i class="fas fa-info"></i></div>
                        @Html.TextBox("inputPosId", null, new { @class = "form-control", placeholder = "POS Id", oninput = "this.value = this.value.replace(/[^0-9]/g, '');" })
                    </div>
                </div>
                <div class="col-md-3">
                    <label for="inputTelephone" class="form-label">Name</label>
                    <div class="input-group">
                        <div class="input-group-text"><i class="fas fa-trademark"></i></div>
                        @Html.TextBox("inputPosName", null, new { @class = "form-control", placeholder = "Pos Name" })
                    </div>
                </div>
                <div class="col-md-3">
                    <label for="inputCellphone" class="form-label">Brand</label>
                    <div class="input-group">
                        <div class="input-group-text"><i class="fas fa-trademark"></i></div>
                        @Html.TextBox("inputPosBrand", null, new { @class = "form-control", placeholder = "Pos Brand" })
                    </div>
                </div>
                <div class="col-md-4">
                    <label for="inputAddress" class="form-label">Full Address</label>
                    <div class="input-group">
                        <div class="input-group-text"><i class="fas fa-map"></i></div>
                        @Html.TextBox("inputFullAddress", null, new { @class = "form-control", placeholder = "POS address" })
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card mt-0">
        <div class="card-header" style="background-color: lightgray">
            Search Results
        </div>
        <div class="card-body">
            <table id="posList" class="display mt-3">
            </table>
        </div>
    </div>

    <div class="d-flex justify-content-start">
        <button type="button" id="openIssue" class="btn btn-primary mr-2">Add Issue</button>
    </div>
}

<script>
    $(document).ready(function () {
        var table = $('#posList').DataTable({
            select: 'single',
            ajax: {
                url: "/Pos/GetAllPosJson",
                type: "GET",
                dataType: "json",
                dataSrc: ''
            },
            columns: [
                { title: "Pos Id", data: "PosId" },
                { title: "Name", data: "Name" },
                { title: "Telephone", data: "Telephone" },
                { title: "Cellphone", data: "Cellphone" },
                { title: "Brand", data: "Brand" },
                { title: "Full Address", data: "FullAddress" }
            ]
        });

        $('#inputPosId, #inputPosName, #inputPosBrand, #inputFullAddress').on('input', function () {
            // Apply the filter and redraw the table
            table
                .column(0).search($('#inputPosId').val())
                .column(1).search($('#inputPosName').val())
                .column(4).search($('#inputPosBrand').val())
                .column(5).search($('#inputFullAddress').val())
                .draw();
        });

        $('#posList tbody').on('click', 'tr', function () {
            if ($(this).hasClass('selected')) {
                $(this).removeClass('selected');
            }
            else {
                table.$('tr.selected').removeClass('selected');
                $(this).addClass('selected');
            }
        });

        $('#button').click(function () {
            table.row('.selected').remove().draw(false);
        });

        $('#openIssue').click(function () {
            console.log('Button clicked');  // Debugging statement
            var data = table.row('.selected').data();
            console.log('Data:', data);  // Debugging statement
            if (data) {
                var url = '/Issue/OpenIssue?' + $.param(data);
                console.log('URL:', url);  // Debugging statement
                window.location.href = url;
            } else {
                alert('Please select a row');
            }
        });
    });
</script>